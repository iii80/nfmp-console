angular.module("console",["ngAnimate","ipCookie","ui.router","ngFileUpload","angular-img-cropper","controllers","services","directives","filters","views"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(t,e,n,a){"use strict";a.defaults.headers.common={"content-type":"application/json;charset=utf-8"},a.interceptors.push("authorityInterceptor"),n.html5Mode(!0),e.otherwise(function(t){t.get("$state").go("main.channel")}),t.state("signIn",{url:"^/sign-in",controller:"signIn",templateProvider:["$templateCache",function(t){return t.get("sign-in.view.html")}]}).state("main",{url:"^/",controller:"main",templateProvider:["$templateCache",function(t){return t.get("main.view.html")}]}).state("main.channel",{url:"^/channel",controller:"channel",templateProvider:["$templateCache",function(t){return t.get("channel.view.html")}]}).state("main.channel.create",{url:"^/channel/create",controller:"channelChange",templateProvider:["$templateCache",function(t){return t.get("channel-change.view.html")}]}).state("main.channel.update",{url:"^/channel/:_id",controller:"channelChange",templateProvider:["$templateCache",function(t){return t.get("channel-change.view.html")}]}).state("main.network",{url:"^/network",controller:"network",templateProvider:["$templateCache",function(t){return t.get("network.view.html")}]}).state("main.hardware",{url:"^/hardware",controller:"hardware",templateProvider:["$templateCache",function(t){return t.get("hardware.view.html")}]})}]).run(["checkSignIn","$templateCache",function(t){t()}]),angular.module("controllers",[]),angular.module("services",[]),angular.module("directives",[]),angular.module("filters",[]),angular.module("views",[]),angular.module("controllers").controller("channelChange",["$scope","$state","$stateParams","$http",function(t,e,n,a){"use strict";t.transmitting=!1,t.action="create",t._id=n._id,t.url="",t.source="",t.remark="",t._id&&(t.action="update",t.transmitting=!0,a.get("/api/channel/"+t._id).then(function(e){var n=e.data;t._id=n.name,t.url=n.url,t.source=n.source,t.remark=n.remark,t.transmitting=!1},function(){t.$emit("notification",{type:"danger",message:"获取频道失败"})})),t.saveChannel=function(){t.transmitting=!0;var n={url:t.url,source:t.source,remark:t.remark};t._id?a.put("/api/channel/"+t._id,n).then(function(){t.$emit("notification",{type:"success",message:"更新频道成功"}),e.go("main.channel",null,{reload:"main.channel"})},function(){t.$emit("notification",{type:"danger",message:"创建频道失败"})}):a.post("/api/channel",n).then(function(){t.$emit("notification",{type:"success",message:"创建频道成功"}),e.go("main.channel",null,{reload:"main.channel"})},function(){t.$emit("notification",{type:"danger",message:"创建频道失败"})})}}]),angular.module("controllers").controller("channel",["$scope","$state","$stateParams","$http",function(t,e,n,a){"use strict";t.transmitting=!1,t.deleteChannelId="",t.channel=[],t.translate=function(t){var e=t.match(/^(\w+)\:\/\//);if(!e||!e[1])return"其他";switch(e[1]){case"rtmp":return"rtmp";case"http":var n=t.match(/\.(\w+)$/);return n&&n[1]?n[1]:"其他";default:return e[1]}},a.get("/api/channel").then(function(e){var n=e.data;t.channel=n}),t.deleteChannel=function(){t.transmitting=!0,a["delete"]("/api/channel/"+t.deleteChannelId).then(function(){return $("#deleteModal").modal("hide"),t.transmitting=!1,t.channel=_.reject(t.channel,{name:t.deleteChannelId}),t.$emit("notification",{type:"success",message:"删除频道成功"})},function(){t.$emit("notification",{type:"danger",message:"删除频道失败"})})}}]),angular.module("controllers").controller("hardware",["$scope","$state","$stateParams","$http","$interval",function(t,e,n,a,i){"use strict";function r(){s=!0,_.map(t.network,function(e,n){t.chart[n]={transmit:new Chart($("#transmitChart"+n).get(0).getContext("2d"),{type:"line",options:{tooltips:{enabled:!1},legend:{display:!1},elements:{line:{borderWidth:1}},animation:{duration:0}}}),receive:new Chart($("#receiveChart"+n).get(0).getContext("2d"),{type:"line",options:{tooltips:{enabled:!1},legend:{display:!1},elements:{line:{borderWidth:1}},animation:{duration:0}}})}})}function o(){_.map(t.network,function(e,n){t.chart[n].transmit.update(),t.chart[n].receive.update()})}t.transmitting=!1,t.cpu=0,t.mem=0,t.network=[],t.data=[],t.chart=[],t.select=0;var s=!1;t.$on("$viewContentLoaded",function(){i(function(){a.get("/api/hardware").then(function(e){var n=e.data;t.cpu=n.cpu,t.mem=n.mem,t.network=n.network,s||r(),o()})},1e3)})}]),angular.module("controllers").controller("main",["$scope","$state",function(t,e){"use strict";"main"===e.current.name&&e.go("main.channel")}]),angular.module("controllers").controller("network",["$scope","$state","$stateParams","$http",function(t,e,n,a){"use strict";t.transmitting=!1,t.network=[],a.get("/api/network").then(function(e){var n=e.data;t.network=n})}]),angular.module("controllers").controller("signIn",["$scope","$timeout","$state","$http",function(t,e,n,a){"use strict";function i(){t.wrong=!1}t.transmitting=!1,t.password="",t.autoSignIn=!1,t.wrong=!1,t.hasKeyValue=!1,t.keyMac="",t.keyValue="",t.username="",a.get("/api/account/key").then(function(e){var n=e.data;n?t.keyMac=n:t.hasKeyValue=!0}),t.$watch(["keyValue","account","password"],i,!0),t.keyForm=function(){t.transmitting=!0,a.put("/api/account/key",{keyValue:t.keyValue}).then(function(){t.hasKeyValue=!0,t.transmitting=!1},function(n){var a=n.data;_.get(a,"error.code")&&(t.wrong=!0),t.animateShake=!0,e(function(){t.animateShake=!1,t.transmitting=!1},600)})},t.signIn=function(){t.transmitting=!0,a.put("/api/account/sign-in",{username:t.username,password:t.password}).then(function(){n.go("main")},function(n){var a=n.data;_.get(a,"error.code")&&(t.wrong=!0),t.animateShake=!0,e(function(){t.animateShake=!1,t.transmitting=!1},600)})}}]),angular.module("services").factory("authorityInterceptor",["$q","$injector",function(t,e){"use strict";return{responseError:function(n){return 401===n.status&&n.data&&n.data.error&&e.get("$state").go("signIn"),t.reject(n)}}}]),angular.module("services").factory("checkSignIn",["$rootScope","$state","ipCookie",function(t,e,n){"use strict";return function(){t.$on("$stateChangeStart",function(t,a,i,r,o){n("consoleSid")||"signIn"===a.name||(t.preventDefault(),e.go("signIn"))})}}]),angular.module("directives").directive("ndNavigation",["$templateCache","$rootScope","$state","$timeout","$http","$filter",function(t,e,n,a,i,r){return{restrict:"E",template:t.get("navigation.view.html"),link:function(t,r){function o(){a(function(){$(".sub-list").each(function(){var t=$(this);t.children(".item").hasClass("active")?t.siblings(".item").addClass("active select"):t.slideUp("fast",function(){t.siblings(".sub-list-heading").removeClass("select")}).siblings(".sub-list-heading").removeClass("active")})})}t.notFoundPages=!1,t.notFoundContents=!1,t.auth={},t.categories=[],t.user={},t.signOut=function(){i.put("/api/account/sign-out").then(function(){n.go("signIn")},function(){t.$emit("notification",{type:"danger",message:"退出登录失败"})})},e.$on("$stateChangeSuccess",function(){a(function(){o()})}),e.$on("mainCategoriesUpdate",function(){loadCategories()}),e.$on("mainUserUpdate",function(){account.reset(),loadUser()}),$(".navigation").on("click",".sub-list-heading",function(){var t=$(this);t.hasClass("select")?t.siblings(".sub-list").slideUp("fast",function(){$(this).siblings(".sub-list-heading").removeClass("select")}):t.siblings(".sub-list").slideDown("fast",function(){$(this).siblings(".sub-list-heading").addClass("select")}),$(".sub-list:visible").not(t.siblings(".sub-list")).slideUp("fast",function(){$(this).siblings(".sub-list-heading").removeClass("select")})})}}}]),angular.module("directives").directive("ndNotification",["$timeout","$rootScope",function(t,e){return{replace:!0,link:function(n){function a(){i=!0,t(function(){r-- >0?a():(i=!1,n.notificationShow=!1)},1e3)}var i,r;e.$on("notification",function(t,e){r=3,n.type=e.type,n.message=e.message,n.notificationShow=!0,i||a()})}}}]);